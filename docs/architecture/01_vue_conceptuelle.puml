@startuml
!theme plain
skinparam backgroundColor white
skinparam defaultFontName Arial

title Architecture Hexagonale - Vue Conceptuelle

' Style
skinparam package {
  BackgroundColor<<Coeur>> #E3F2FD
  BackgroundColor<<Application>> #E8F5E9
  BackgroundColor<<Adapters>> #FFEBEE
  BackgroundColor<<Main>> #F3E5F5
  BorderColor #424242
  FontStyle bold
}

package "CŒUR MÉTIER" <<Coeur>> {
  package "Domaine" {
    [Entités]
    [Règles métier]
    note right of [Entités]
      Ticket, User, Status
      Logique métier pure
      ZERO dépendance externe
    end note
  }
  
  package "Ports" {
    interface "Ports entrants\n(Primary)" as ports_in
    interface "Ports sortants\n(Secondary)" as ports_out
    
    ports_in -[hidden]- ports_out
    
    note right of ports_in
      Interfaces de use cases
      Ex: CreateTicket (ABC)
      
      **Bénéfice :** changer d'adapter
      entrant (FastAPI → Flask → CLI)
      sans toucher aux use cases
      
      **Simplification projet : omis**
      (couplage direct API → Use Cases)
    end note
    
    note right of ports_out
      Interfaces de persistance
      Ex: TicketRepository (ABC)
      Le métier dit "ce dont j'ai besoin"
    end note
  }
}

package "APPLICATION" <<Application>> {
  [Use Cases]
  note right of [Use Cases]
    CreateTicket, ListTickets...
    Orchestration métier
    Coordonne Domaine + Ports
    
    **Dans projet : implémentent**
    **implicitement les ports entrants**
  end note
}

package "ADAPTERS" <<Adapters>> {
  package "Entrants (Driving)" {
    [API Web]
    note bottom of [API Web]
      Reçoit requêtes externes
      Appelle les use cases
      
      **Devrait implémenter**
      **ports entrants (simplifié)**
    end note
  }
  
  package "Sortants (Driven)" {
    [Persistance]
    note bottom of [Persistance]
      Implémente les ports sortants
      Ex: SQLite, InMemory
    end note
  }
}

package "COMPOSITION ROOT" <<Main>> {
  [Câblage]
  note right of [Câblage]
    Instancie les adapters
    Injecte dans les use cases
  end note
}

' Relations
[Use Cases] --> [Entités] : orchestre
[Use Cases] --> [Règles métier] : applique
[Use Cases] ..|> ports_in : implémentent\n(implicite)
[Use Cases] --> ports_out : dépend de

[Persistance] ..|> ports_out : implémente

[API Web] ..> ports_in : devrait\nimplémenter
[API Web] --> [Use Cases] : appelle\n(simplifié)

[Câblage] ..> [API Web]
[Câblage] ..> [Persistance]
[Câblage] ..> [Use Cases]

' Note explicative
note bottom
  **Architecture hexagonale complète**
  
  **Ports entrants** : interfaces exposées par l'application (use cases)
  **Ports sortants** : interfaces requises par l'application (repositories)
  
  **Adapters entrants** : implémentent/appellent les ports entrants
  **Adapters sortants** : implémentent les ports sortants
  
  **Simplification pédagogique du projet** :
  Les ports entrants sont omis → API appelle directement les use cases
  
  **Flux d'exécution** : API → Use Cases → Domaine
  **Flux de dépendances** : Tout pointe vers le CŒUR
end note

@enduml
